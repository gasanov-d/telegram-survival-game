<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Survival TG</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#111;
  color:#fff;
  font-family:Arial;
}
#game{
  position:relative;
  width:100vw;
  height:100vh;
  background:#2e7d32;
}
.tile{
  position:absolute;
  width:40px;
  height:40px;
}
.grass{background:#2e7d32;}
.tree{background:#1b5e20;}
.stone{background:#757575;}

#player{
  position:absolute;
  width:32px;
  height:32px;
  background:#ffd600;
  border-radius:6px;
  z-index:10;
}

#ui{
  position:absolute;
  bottom:0;
  width:100%;
  background:rgba(0,0,0,0.7);
  padding:6px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}

.btn{
  background:#1976d2;
  padding:8px;
  border-radius:6px;
  margin:2px;
  text-align:center;
  user-select:none;
}

#joystick{
  position:absolute;
  bottom:90px;
  left:20px;
  width:120px;
  height:120px;
  border-radius:50%;
  background:rgba(255,255,255,0.1);
}
#stick{
  position:absolute;
  left:40px;
  top:40px;
  width:40px;
  height:40px;
  border-radius:50%;
  background:#fff;
}
</style>
</head>

<body>
<div id="game"></div>

<div id="joystick">
  <div id="stick"></div>
</div>

<div id="ui">
  <div>
    ‚ù§Ô∏è <span id="hp">100</span> |
    ‚ö° <span id="energy">100</span> |
    ü™µ <span id="wood">0</span>
  </div>
  <div>
    <span class="btn" onclick="build()">üè† –°—Ç—Ä–æ–∏—Ç—å</span>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const game = document.getElementById("game");

const mapW = 20;
const mapH = 15;
const tileSize = 40;

let tiles = [];
let wood = 0;
let hp = 100;
let energy = 100;

for(let y=0;y<mapH;y++){
  for(let x=0;x<mapW;x++){
    let t = document.createElement("div");
    t.className="tile grass";
    t.style.left = x*tileSize+"px";
    t.style.top = y*tileSize+"px";

    if(Math.random()<0.1){
      t.className="tile tree";
      t.dataset.type="tree";
    }

    game.appendChild(t);
    tiles.push(t);
  }
}

const player = document.createElement("div");
player.id="player";
let px=200, py=200;
game.appendChild(player);

function render(){
  player.style.left = px+"px";
  player.style.top = py+"px";
  document.getElementById("wood").textContent=wood;
  document.getElementById("hp").textContent=hp;
  document.getElementById("energy").textContent=energy;
}
render();

/* COLLISION + GATHER */
function checkTile(){
  tiles.forEach(t=>{
    let tx=parseInt(t.style.left);
    let ty=parseInt(t.style.top);
    if(Math.abs(px-tx)<30 && Math.abs(py-ty)<30){
      if(t.dataset.type==="tree"){
        wood++;
        t.className="tile grass";
        delete t.dataset.type;
      }
    }
  });
}

/* JOYSTICK */
let stick=document.getElementById("stick");
let joy=document.getElementById("joystick");
let dragging=false;

joy.addEventListener("touchstart",()=>dragging=true);
joy.addEventListener("touchend",()=>{
  dragging=false;
  stick.style.left="40px";
  stick.style.top="40px";
});
joy.addEventListener("touchmove",e=>{
  if(!dragging)return;
  let r=joy.getBoundingClientRect();
  let x=e.touches[0].clientX-r.left-20;
  let y=e.touches[0].clientY-r.top-20;
  x=Math.max(0,Math.min(80,x));
  y=Math.max(0,Math.min(80,y));
  stick.style.left=x+"px";
  stick.style.top=y+"px";
  px+= (x-40)/5;
  py+= (y-40)/5;
  energy=Math.max(0,energy-0.05);
  checkTile();
  render();
});

/* BUILD */
function build(){
  if(wood>=5){
    wood-=5;
    let h=document.createElement("div");
    h.className="tile";
    h.style.background="#8d6e63";
    h.style.left=(px-20)+"px";
    h.style.top=(py-20)+"px";
    game.appendChild(h);
  }
  render();
}
</script>
</body>
</html>
