<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Survival Game</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
html,body{margin:0;padding:0;overflow:hidden;background:#2e7d32;font-family:Arial}
canvas{display:block}
#ui{position:fixed;top:10px;left:10px;color:#fff;font-size:14px}
#inv{margin-top:5px}
#btns{position:fixed;bottom:40px;right:30px}
.btn{width:70px;height:70px;border-radius:50%;background:#d32f2f;color:#fff;
display:flex;align-items:center;justify-content:center;margin-top:10px}
#joy{position:fixed;bottom:40px;left:30px;width:120px;height:120px;border-radius:50%;
background:rgba(0,0,0,.3)}
#stick{width:50px;height:50px;border-radius:50%;background:#fff;position:absolute;left:35px;top:35px}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="ui">
  ‚ù§Ô∏è <span id="hp"></span>
  <div id="inv"></div>
</div>

<div id="joy"><div id="stick"></div></div>

<div id="btns">
  <div class="btn" id="hit">–£–î–ê–†</div>
  <div class="btn" id="base">–ë–ê–ó–ê</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();

const c = document.getElementById("game"), ctx=c.getContext("2d");
c.width=innerWidth; c.height=innerHeight;

const world={w:3000,h:3000};
const player={x:1500,y:1500,s:28,spd:4,dx:0,dy:0,hp:100};
let mode="world";

let inv=JSON.parse(localStorage.getItem("inv"))||{wood:0,stone:0,fire:false};

const objs=[];
for(let i=0;i<20;i++)objs.push({x:Math.random()*world.w,y:Math.random()*world.h,t:"wood",hp:3});
for(let i=0;i<15;i++)objs.push({x:Math.random()*world.w,y:Math.random()*world.h,t:"stone",hp:4});

const joy=document.getElementById("joy"),stick=document.getElementById("stick");
let drag=false;
joy.ontouchstart=()=>drag=true;
joy.ontouchend=()=>{drag=false;stick.style.left="35px";stick.style.top="35px";player.dx=player.dy=0}
joy.ontouchmove=e=>{
if(!drag)return;
let r=joy.getBoundingClientRect(),t=e.touches[0];
let dx=t.clientX-r.left-60,dy=t.clientY-r.top-60;
let d=Math.hypot(dx,dy);if(d>40){dx*=40/d;dy*=40/d}
stick.style.left=dx+60-25+"px";stick.style.top=dy+60-25+"px";
player.dx=dx/40;player.dy=dy/40;
};

document.getElementById("hit").onclick=()=>{
objs.forEach(o=>{
if(o.hp<=0)return;
if(Math.hypot(player.x-o.x,player.y-o.y)<60){
o.hp--;
if(o.hp<=0){
inv[o.t]++; save();
}
}
});
};

document.getElementById("base").onclick=()=>{
mode=mode==="world"?"base":"world";
};

function save(){localStorage.setItem("inv",JSON.stringify(inv))}

function draw(){
ctx.clearRect(0,0,c.width,c.height);
if(mode==="world"){
ctx.fillStyle="#388e3c";ctx.fillRect(0,0,c.width,c.height);
objs.forEach(o=>{
if(o.hp<=0)return;
ctx.fillStyle=o.t==="wood"?"#1b5e20":"#757575";
ctx.fillRect(o.x-player.x+c.width/2,o.y-player.y+c.height/2,40,40);
});
ctx.fillStyle="#ffeb3b";
ctx.fillRect(c.width/2-player.s/2,c.height/2-player.s/2,player.s,player.s);
}else{
ctx.fillStyle="#263238";ctx.fillRect(0,0,c.width,c.height);
ctx.fillStyle="#fff";ctx.fillText("üè† –ë–ê–ó–ê",c.width/2-30,80);
ctx.fillText(`–î–µ—Ä–µ–≤–æ: ${inv.wood}`,c.width/2-50,120);
ctx.fillText(`–ö–∞–º–µ–Ω—å: ${inv.stone}`,c.width/2-50,150);
if(!inv.fire&&inv.wood>=5){
ctx.fillText("–ù–∞–∂–º–∏ –£–î–ê–† —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Å—Ç—ë—Ä",c.width/2-120,200);
}
}
document.getElementById("hp").textContent=player.hp;
document.getElementById("inv").innerHTML=`ü™µ${inv.wood} ‚õè${inv.stone} üî•${inv.fire?"‚úî":""}`;
}

function update(){
if(mode==="world"){
player.x+=player.dx*player.spd;
player.y+=player.dy*player.spd;
}
}

function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>

</body>
</html>
